name: PyPI Cleanup Example
on:
  workflow_dispatch:
  release:
    types:
      - published

jobs:
  cleanup:
    runs-on: windows-latest
    defaults:
      run:
        working-directory: examples/pypi_cleanup_workflow
        shell: pwsh
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 22
      - name: Install Google Chrome
        shell: pwsh
        run: choco install googlechrome --no-progress --yes
      - name: Set up Rust toolchain
        uses: actions-rust-lang/setup-rust-toolchain@v1
        with:
          toolchain: stable
          override: true
          profile: minimal
      - name: Install Terminator browser extension
        shell: pwsh
        working-directory: .
        run: >
          cargo run --bin terminator -- mcp run
          crates/terminator/browser-extension/install_chrome_extension_ui.yml
          --command "npx -y terminator-mcp-agent"

      - run: npm ci
      - run: npm run build
      - run: npm run run
        env:
          PYPI_UI_USERNAME: ${{ secrets.PYPI_UI_USERNAME }}
          PYPI_UI_PASSWORD: ${{ secrets.PYPI_UI_PASSWORD }}
          PYPI_UI_TOTP_SECRET: ${{ secrets.PYPI_UI_TOTP_SECRET }}
          PACKAGE_NAME: ${{ secrets.PACKAGE_NAME }}
